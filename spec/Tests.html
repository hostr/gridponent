<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gridponent tests</title>
    <link href="https://code.jquery.com/qunit/qunit-1.20.0.css" rel="stylesheet" />
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="../styles/styles.css" rel="stylesheet">
    <link href="../src/gridponent.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://code.jquery.com/qunit/qunit-1.20.0.js"></script>
    <script src="https://cdn.polyfill.io/v2/polyfill.js?features=Intl.~locale.en"></script>
    <script src="../data/products.js"></script>
    <!--<script src="../scripts/webcomponents.min.js"></script>-->
    <script src="../gridponent.js"></script>
    <script src="../scripts/modernizr-custom-3.0.0.min.js"></script>
    <script>
    var fns = fns || {};

    fns.getData = function (pagingModel) {
        var model = new gridponent.RequestModel(data.products);
        return model;
    };

    fns.getName = function (row) {
        return row.Name;
    };

    fns.dropdown = function (row, column) {
        var val = row[column.Field];
        var data = fns.getData().Data;
        var out = [];
        out.push('<select name="MakeFlag" class="form-control">');
        data.forEach(function (r) {
            if (val == r[column.Field]) {
                out.push('<option value="' + r[column.Field] + '" selected="selected">' + gridponent.escapeHTML(r.Name) + '</option>');
            }
            else {
                out.push('<option value="' + r[column.Field] + '">' + gridponent.escapeHTML(r.Name) + '</option>');
            }
        });
        out.push('</select>');
        return out.join('');
    };

    fns.average = function (column) {
        return 10;
    };

    fns.rowSelected = function (model) {
        gp.info(model);
    };

    </script>
</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="navbar-collapse collapse" data-jaxpanel="navbar">
                <ul class="nav navbar-nav">
                    <li><a href="#table">gridponent</a></li>
                    <li><a href="#tests">tests</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container-fluid" id="top-container">
       

        <div class="tab" id="tests">
            <h3>tests</h3>
            <div class="box-border dark">
                <div class="box dark">
                    <div id="qunit"></div>
                    <div id="qunit-fixture"></div>
                </div>
            </div>
        </div>

        <div class="tab" id="table">
            <h3>table</h3>
            <div class="box-border dark">
                <div class="box dark">
                    <grid-ponent id="gp"
                                 paging="top-right" 
                                 sorting="true" 
                                 fixed-headers="true" 
                                 fixed-footers="true"
                                 style="width:100%;height:411px" 
                                 responsive="true"
                                 onrowselect="/test?productid={{ProductID}}&color={{Color}}"
                                 search="top-left"
                                 data-source="data.products"
                                 create="/Products/Create"
                                 update="/Products/Update"
                                 destroy="/Products/Destroy">
                        <gp-column header="Product" field="ProductID" template="fns.getName" edit-template="fns.dropdown"></gp-column>
                        <gp-column field="MakeFlag" header="Make" width="75px"></gp-column>
                        <gp-column field="SafetyStockLevel" header="Safety Stock Level" footer-template="fns.average"></gp-column>
                        <gp-column field="StandardCost" header="Standard Cost" footer-template="fns.average" format="C"></gp-column>
                        <gp-column field="SellStartDate" header="Sell Start Date" format="d MMMM, yyyy"></gp-column>
                        <gp-column field="Markup" readonly header="Marked-Up Name"></gp-column>
                        <gp-column commands="Edit,Delete"></gp-column>
                    </grid-ponent>
                </div>
            </div>
        </div>

        <h3>logging</h3>
        <div class="box-border dark">
            <div class="box dark">
                <div class="btn-group">
                    <a class="btn btn-default" href="?">off</a>
                    <a class="btn btn-default" href="?log">on</a>
                    <a class="btn btn-default" href="?log=warn">warn</a>
                    <a class="btn btn-default" href="?log=info">info</a>
                    <a class="btn btn-default" href="?log=verbose">verbose</a>
                </div>
            </div>
        </div>

    </div>

    <div id="background"></div>

    <script src="tests.js"></script>
    <script src="../scripts/bootstrap-datepicker.min.js"></script>
    <link href="../styles/bootstrap-datepicker.min.css" rel="stylesheet" />
    <script>
        (function () {
            var tabs = document.getElementsByClassName('tab');

            var swapTabs = function () {
                if (window.location.hash) {
                    var tabId = window.location.hash.substring(1);
                    for (var i = 0; i < tabs.length; i++) {
                        if (tabs[i].id === tabId) {
                            tabs[i].style.display = 'block';
                        }
                        else {
                            tabs[i].style.display = 'none';
                        }
                    }
                }
            };

            window.addEventListener('hashchange', swapTabs);

            if (!window.location.hash) {
                window.location.hash = '#tests';
            }
            else {
                swapTabs();
            }

            if (!Modernizr.inputtypes.date) {
                // load date input type polyfills
                //var css = document.createElement("link");
                //css.rel = 'stylesheet';
                //css.media = 'all';
                //css.type = "text/css";
                //css.href = '../styles/bootstrap-datepicker.min.css';
                //document.body.appendChild(css);

                //var s = document.createElement("script");
                //s.type = "text/javascript";
                //s.src = '../Scripts/bootstrap-datepicker.min.js';
                //document.body.appendChild(s);

                var tries = 0;
                var setDatePickers = function (evt) {
                    var context = evt.target;
                    //if (typeof ($().datepicker) === 'undefined' && tries++ < 5) {
                    //    // wait for the polyfill to load
                    //    setTimeout(setDatePickers, 250);
                    //}
                    //else {
                        if (typeof ($().datepicker) !== 'undefined') {
                            var input, dateInputs = evt.target.querySelectorAll('input[type=date]');
                            for (var i = 0; i < dateInputs.length; i++) {
                                input = dateInputs[i];

                                if (input.value && input.value.length && input.value.length >= '2015-05-18'.length) {
                                    var split = input.value.split('-');
                                    input.value = [split[1], split[2], split[0]].join('/');
                                }

                                $(input).datepicker({
                                    orientation: 'left top'
                                });
                            }
                        }
                    //}
                };

                document.addEventListener('afterEdit', setDatePickers);
            }
        })();
    </script>

</body>
</html>